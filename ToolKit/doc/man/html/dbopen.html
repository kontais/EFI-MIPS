<HTML>
<BODY>
<PRE>
<!-- Manpage converted by man2html 3.0.1 -->


<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>


</PRE>
<H2>NAME</H2><PRE>
       dbopen - database access methods


</PRE>
<H2>SYNOPSIS</H2><PRE>
       <B>#include</B> <B>&lt;sys/types.h&gt;</B>
       <B>#include</B> <B>&lt;limits.h&gt;</B>
       <B>#include</B> <B>&lt;db.h&gt;</B>

       <B>DB</B> <B>*</B>
       <B>dbopen(const</B> <B>char</B> <B>*file,</B> <B>int</B> <B>flags,</B> <B>int</B> <B>mode,</B> <B>DBTYPE</B> <B>type,</B>
	    <B>const</B> <B>void</B> <B>*openinfo);</B>


</PRE>
<H2>DESCRIPTION</H2><PRE>
       <I>Dbopen</I>  is  the	library interface to database files.  The
       supported file formats are btree,  hashed  and  UNIX  file
       oriented.   The	btree  format  is  a  representation of a
       sorted, balanced tree structure.  The hashed format is  an
       extensible,  dynamic hashing scheme.  The flat-file format
       is a byte  stream  file	with  fixed  or  variable  length
       records.  The formats and file format specific information
       are described in detail in their respective  manual  pages
       <B><A HREF="btree.html">btree(3)</A></B>, <B><A HREF="hash.html">hash(3)</A></B> and <B><A HREF="recno.html">recno(3)</A></B>.

       Dbopen opens <I>file</I> for reading and/or writing.  Files never
       intended to be preserved on disk may be created by setting
       the file parameter to NULL.

       The  <I>flags</I>  and	<I>mode</I>  <I>arguments</I>  are  as specified to the
       <B><A HREF="open.html">open(2)</A></B>	routine,  however,  only  the  O_CREAT,   O_EXCL,
       O_EXLOCK,   O_NONBLOCK,	O_RDONLY,  O_RDWR,  O_SHLOCK  and
       O_TRUNC flags are meaningful.  (Note, opening  a  database
       file O_WRONLY is not possible.)

       The  <I>type</I>  argument  is	of type DBTYPE (as defined in the
       &lt;db.h&gt; include file) and may be set to  DB_BTREE,  DB_HASH
       or DB_RECNO.

       The  <I>openinfo</I>  argument	is  a pointer to an access method
       specific structure described in the access method's manual
       page.   If  <I>openinfo</I>  is NULL, each access method will use
       defaults appropriate for the system and the access method.

       <I>Dbopen</I>  returns a pointer to a DB structure on success and
       NULL on error.  The DB structure is defined in the  &lt;db.h&gt;
       include file, and contains at least the following fields:

       typedef struct {
	      DBTYPE type;
	      int (*close)(const DB *db);
	      int (*del)(const DB *db, const DBT *key, u_int flags);
	      int (*fd)(const DB *db);
	      int (*get)(const DB *db, DBT *key, DBT *data, u_int flags);
	      int (*put)(const DB *db, DBT *key, const DBT *data,
		   u_int flags);

			 January 2, 1994			1

<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>

	      int (*sync)(const DB *db, u_int flags);
	      int (*seq)(const DB *db, DBT *key, DBT *data, u_int flags);
       } DB;

       These elements describe a database type and a set of func-
       tions performing various actions.  These functions take	a
       pointer	to  a  structure as returned by <I>dbopen</I>, and some-
       times one or more pointers to key/data  structures  and	a
       flag value.

       type   The  type of the underlying access method (and file
	      format).

       close  A pointer to a routine to flush any cached informa-
	      tion  to	disk,  free  any allocated resources, and
	      close the underlying file(s).  Since key/data pairs
	      may  be  cached in memory, failing to sync the file
	      with a <I>close</I> or <I>sync</I> function may result in  incon-
	      sistent or lost information.  <I>Close</I> routines return
	      -1 on error (setting <I>errno</I>) and 0 on success.

       del    A pointer to a routine  to  remove  key/data  pairs
	      from the database.

	      The  parameter  <I>flag</I>  may  be  set to the following
	      value:

	      R_CURSOR
		     Delete the record referenced by the  cursor.
		     The  cursor  must	have previously been ini-
		     tialized.

	      <I>Delete</I> routines return -1 on error (setting <I>errno</I>),
	      0 on success, and 1 if the specified <I>key</I> was not in
	      the file.

       fd     A  pointer  to  a  routine  which  returns  a  file
	      descriptor   representative   of	 the   underlying
	      database.  A file descriptor referencing	the  same
	      file  will  be returned to all processes which call
	      <I>dbopen</I> with the same <I>file</I> name.  This file descrip-
	      tor  may	be  safely  used  as  an  argument to the
	      <B><A HREF="fcntl.html">fcntl(2)</A></B> and <B><A HREF="flock.html">flock(2)</A></B> locking functions.	The  file
	      descriptor  is  not necessarily associated with any
	      of the underlying files used by the access  method.
	      No  file	descriptor  is	available  for	in memory
	      databases.  <I>Fd</I> routines return -1 on error (setting
	      <I>errno</I>), and the file descriptor on success.

       get    A  pointer  to a routine which is the interface for
	      keyed retrieval from the database.  The address and
	      length  of  the  data associated with the specified
	      <I>key</I> are returned in  the	structure  referenced  by
	      <I>data</I>.   <I>Get</I>  routines  return  -1 on error (setting

			 January 2, 1994			2

<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>

	      <I>errno</I>), 0 on success, and 1 if the <I>key</I> was  not  in
	      the file.

       put    A  pointer  to a routine to store key/data pairs in
	      the database.

	      The parameter <I>flag</I> may be set to one of the follow-
	      ing values:

	      R_CURSOR
		     Replace  the key/data pair referenced by the
		     cursor.  The  cursor  must  have  previously
		     been initialized.

	      R_IAFTER
		     Append  the  data immediately after the data
		     referenced by <I>key</I>, creating a  new  key/data
		     pair.   The  record  number  of the appended
		     key/data pair is returned in the <I>key</I>  struc-
		     ture.   (Applicable  only	to  the  DB_RECNO
		     access method.)

	      R_IBEFORE
		     Insert the data immediately before the  data
		     referenced  by  <I>key</I>, creating a new key/data
		     pair.  The record	number	of  the  inserted
		     key/data  pair is returned in the <I>key</I> struc-
		     ture.   (Applicable  only	to  the  DB_RECNO
		     access method.)

	      R_NOOVERWRITE
		     Enter  the new key/data pair only if the key
		     does not previously exist.

	      R_SETCURSOR
		     Store the key/data pair, setting or initial-
		     izing  the  position of the cursor to refer-
		     ence it.  (Applicable only to  the  DB_BTREE
		     and DB_RECNO access methods.)

	      R_SETCURSOR  is available only for the DB_BTREE and
	      DB_RECNO access methods because it implies that the
	      keys  have an inherent order which does not change.

	      R_IAFTER and R_IBEFORE are available only  for  the
	      DB_RECNO access method because they each imply that
	      the access method is able to create new keys.  This
	      is  only	true if the keys are ordered and indepen-
	      dent, record numbers for example.

	      The default behavior of  the  <I>put</I>  routines  is  to
	      enter  the  new key/data pair, replacing any previ-
	      ously existing key.

			 January 2, 1994			3

<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>

	      <I>Put</I> routines return -1 on error (setting <I>errno</I>),	0
	      on success, and 1 if the R_NOOVERWRITE <I>flag</I> was set
	      and the key already exists in the file.

       seq    A pointer to a routine which is the  interface  for
	      sequential   retrieval   from  the  database.   The
	      address and length of the key are returned  in  the
	      structure  referenced  by  <I>key</I>, and the address and
	      length of the data are returned  in  the	structure
	      referenced by <I>data</I>.

	      Sequential key/data pair retrieval may begin at any
	      time, and the position of  the  ``cursor''  is  not
	      affected	by  calls  to  the <I>del</I>, <I>get</I>, <I>put</I>, or <I>sync</I>
	      routines.  Modifications to the database	during	a
	      sequential scan will be reflected in the scan, i.e.
	      records inserted behind  the  cursor  will  not  be
	      returned	while  records	inserted  in front of the
	      cursor will be returned.

	      The flag value <B>must</B> be set to one of the	following
	      values:

	      R_CURSOR
		     The  data	associated with the specified key
		     is returned.  This differs from the <I>get</I> rou-
		     tines  in	that  it  sets or initializes the
		     cursor to the location of the key	as  well.
		     (Note,  for  the DB_BTREE access method, the
		     returned key is  not  necessarily	an  exact
		     match  for  the specified key.  The returned
		     key is the  smallest  key	greater  than  or
		     equal  to the specified key, permitting par-
		     tial key matches and range searches.)

	      R_FIRST
		     The first key/data pair of the  database  is
		     returned,	and the cursor is set or initial-
		     ized to reference it.

	      R_LAST The last key/data pair of	the  database  is
		     returned,	and the cursor is set or initial-
		     ized to reference it.  (Applicable  only  to
		     the DB_BTREE and DB_RECNO access methods.)

	      R_NEXT Retrieve the key/data pair immediately after
		     the cursor.  If the cursor is not	yet  set,
		     this is the same as the R_FIRST flag.

	      R_PREV Retrieve	the   key/data	pair  immediately
		     before the cursor.  If the cursor is not yet
		     set,  this  is  the same as the R_LAST flag.
		     (Applicable  only	to   the   DB_BTREE   and
		     DB_RECNO access methods.)

			 January 2, 1994			4

<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>

	      R_LAST  and  R_PREV  are	available  only  for  the
	      DB_BTREE and DB_RECNO access methods  because  they
	      each  imply  that  the  keys have an inherent order
	      which does not change.

	      <I>Seq</I> routines return -1 on error (setting <I>errno</I>),	0
	      on  success  and	1  if there are no key/data pairs
	      less than or greater than the specified or  current
	      key.   If the DB_RECNO access method is being used,
	      and if the database file	is  a  character  special
	      file  and  no complete key/data pairs are currently
	      available, the <I>seq</I> routines return 2.

       sync   A pointer to a routine to flush any cached informa-
	      tion  to	disk.  If the database is in memory only,
	      the <I>sync</I> routine has no effect and will always suc-
	      ceed.

	      The flag value may be set to the following value:

	      R_RECNOSYNC
		     If the DB_RECNO access method is being used,
		     this flag causes the sync routine	to  apply
		     to  the btree file which underlies the recno
		     file, not the recno file itself.	(See  the
		     <I>bfname</I> field of the <B><A HREF="recno.html">recno(3)</A></B> manual page for
		     more information.)

	      <I>Sync</I> routines return -1 on  error  (setting  <I>errno</I>)
	      and 0 on success.


</PRE>
<H2>KEY/DATA PAIRS</H2><PRE>
       Access to all file types is based on key/data pairs.  Both
       keys and data are represented by the following data struc-
       ture:

       typedef struct {
	      void *data;
	      size_t size;
       } DBT;

       The elements of the DBT structure are defined as follows:

       data   A pointer to a byte string.

       size   The length of the byte string.

       Key  and data byte strings may reference strings of essen-
       tially unlimited length although any two of them must  fit
       into  available	memory	at  the  same time.  It should be
       noted that the access methods provide no guarantees  about
       byte string alignment.

			 January 2, 1994			5

<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>						<B><A HREF="DBOPEN.html">DBOPEN(3)</A></B>


</PRE>
<H2>ERRORS</H2><PRE>
       The  <I>dbopen</I>  routine may fail and set <I>errno</I> for any of the
       errors specified for the library routines <B><A HREF="open.html">open(2)</A></B> and <I>mal-</I>
       <B><A HREF="malloc.html">loc(3)</A></B> or the following:

       [EFTYPE]
	      A file is incorrectly formatted.

       [EINVAL]
	      A  parameter has been specified (hash function, pad
	      byte etc.) that is incompatible  with  the  current
	      file  specification  or which is not meaningful for
	      the function (for example, use of the cursor  with-
	      out  prior  initialization)  or there is a mismatch
	      between the version number of file  and  the  soft-
	      ware.

       The  <I>close</I>  routines may fail and set <I>errno</I> for any of the
       errors  specified  for  the  library  routines	<B><A HREF="close.html">close(2)</A></B>,
       <B><A HREF="read.html">read(2)</A></B>, <B><A HREF="write.html">write(2)</A></B>, <B><A HREF="malloc.html">free(3)</A></B>, or <B><A HREF="fsync.html">fsync(2)</A></B>.

       The  <I>del</I>, <I>get</I>, <I>put</I> and <I>seq</I> routines may fail and set <I>errno</I>
       for any of the errors specified for the	library  routines
       <B><A HREF="read.html">read(2)</A></B>, <B><A HREF="write.html">write(2)</A></B>, <B><A HREF="malloc.html">free(3)</A></B> or <B><A HREF="malloc.html">malloc(3)</A></B>.

       The  <I>fd</I>	routines will fail and set <I>errno</I> to ENOENT for in
       memory databases.

       The <I>sync</I> routines may fail and set <I>errno</I> for  any  of  the
       errors specified for the library routine <B><A HREF="fsync.html">fsync(2)</A></B>.


</PRE>
<H2>SEE ALSO</H2><PRE>
       <B><A HREF="btree.html">btree(3)</A></B>, <B><A HREF="hash.html">hash(3)</A></B>, <B><A HREF="mpool.html">mpool(3)</A></B>, <B><A HREF="recno.html">recno(3)</A></B>

       <I>LIBTP:</I>  <I>Portable,</I>  <I>Modular</I>  <I>Transactions</I>  <I>for</I>  <I>UNIX</I>, Margo
       Seltzer, Michael Olson, USENIX proceedings, Winter 1992.


</PRE>
<H2>BUGS</H2><PRE>
       The typedef DBT is a mnemonic for ``data base thang'', and
       was  used  because  noone could think of a reasonable name
       that wasn't already used.

       The file descriptor interface  is  a  kluge  and  will  be
       deleted in a future version of the interface.

       None  of the access methods provide any form of concurrent
       access, locking, or transactions.

			 January 2, 1994			6

</PRE>
<HR>
<ADDRESS>
Man(1) output converted with
<a href="http://www.oac.uci.edu/indiv/ehood/man2html.html">man2html</a>
</ADDRESS>
</BODY>
</HTML>
